{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\wx\\model\\wx_goods.js"
    ],
    "names": [
        "module",
        "exports",
        "think",
        "Model",
        "getProductList",
        "goodsId",
        "goods",
        "model",
        "where",
        "goods_id",
        "select",
        "getSpecificationList",
        "specificationRes",
        "alias",
        "field",
        "join",
        "table",
        "as",
        "on",
        "specificationList",
        "hasSpecificationList",
        "i",
        "length",
        "specItem",
        "specification_id",
        "push",
        "name",
        "valueList",
        "j",
        "addData",
        "param",
        "create_date",
        "datetime",
        "del_flag",
        "id",
        "uuid",
        "add",
        "delData",
        "delete",
        "delFlagData",
        "update",
        "update_date",
        "updateData",
        "pageData",
        "sql",
        "page",
        "current",
        "order",
        "isEmpty",
        "category_id",
        "brand_id",
        "is_on_sale",
        "is_new",
        "is_hot",
        "data",
        "countSelect",
        "allData",
        "getData",
        "find",
        "changeStatus",
        "type"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\wx\\model\\wx_goods.js",
    "sourcesContent": [
        "module.exports = class extends think.Model {\n  /**\n   * 获取商品的product\n   * @param goodsId\n   * @returns {Promise.<*>}\n   */\n  async getProductList(goodsId) {\n    const goods = await this.model('wx_product').where({goods_id: goodsId}).select();\n    return goods;\n  }\n\n  /**\n   * 获取商品的规格信息\n   * @param goodsId\n   * @returns {Promise.<Array>}\n   */\n  async getSpecificationList(goodsId) {\n    // 根据sku商品信息，查找规格值列表\n    const specificationRes = await this.model('wx_goods_specification').alias('gs')\n      .field(['gs.*', 's.name'])\n      .join({\n        table: 'wx_specification',\n        join: 'inner',\n        as: 's',\n        on: ['specification_id', 'id']\n      })\n      .where({goods_id: goodsId}).select();\n\n    const specificationList = [];\n    const hasSpecificationList = {};\n    // 按规格名称分组\n    for (let i = 0; i < specificationRes.length; i++) {\n      const specItem = specificationRes[i];\n      if (!hasSpecificationList[specItem.specification_id]) {\n        specificationList.push({\n          specification_id: specItem.specification_id,\n          name: specItem.name,\n          valueList: [specItem]\n        });\n        hasSpecificationList[specItem.specification_id] = specItem;\n      } else {\n        for (let j = 0; j < specificationList.length; j++) {\n          if (specificationList[j].specification_id === specItem.specification_id) {\n            specificationList[j].valueList.push(specItem);\n            break;\n          }\n        }\n      }\n    }\n\n    return specificationList;\n  }\n\n\n  async addData(param){\n    param.create_date=think.datetime();\n    param.del_flag=0;\n    param.id=think.uuid('v1');\n    await this.add(param);\n  }\n\n  async delData(param){\n    await this.where({id:param.id}).delete();\n  }\n\n  async delFlagData(param){\n    let id=param.id;\n    await this.where({id:id}).update({update_date:think.datetime(),del_flag:1});\n  }\n\n  async updateData(param){\n    let id=param.id;\n    param.update_date=think.datetime();\n    delete param.id;\n    delete param.create_date;\n    await this.where({id:id}).update(param);\n  }\n\n  async pageData(param){\n    let sql=this.page(param.current).field(['f.*', 'g.name as categoryname', 'h.name as brandname'])\n      .alias('f')\n      .join({\n        table: 'wx_category',\n        join: 'left',\n        as: 'g',\n        on: ['f.category_id', 'g.id']\n      }).join({\n        table: 'wx_brand',\n        join: 'left',\n        as: 'h',\n        on: ['f.brand_id', 'h.id']\n      }).where({'f.del_flag':0}).order('f.create_date desc');\n    if(!think.isEmpty(param.category_id)&&param.category_id!=\"-1\"){\n      sql=sql.where({'f.category_id':['like', '%'+param.category_id+'%']});\n    }\n    if(!think.isEmpty(param.name)){\n      sql=sql.where({'f.name':['like', '%'+param.name+'%']});\n    }\n    if(!think.isEmpty(param.brand_id)&&param.brand_id!=\"-1\"){\n      sql=sql.where({'f.brand_id':['like', '%'+param.brand_id+'%']});\n    }\n    if(!think.isEmpty(param.is_on_sale)&&param.is_on_sale!=\"-1\"){\n      sql=sql.where({'f.is_on_sale':['like', '%'+param.is_on_sale+'%']});\n    }\n    if(!think.isEmpty(param.is_new)&&param.is_new!=\"-1\"){\n      sql=sql.where({'f.is_new':['like', '%'+param.is_new+'%']});\n    }\n    if(!think.isEmpty(param.is_hot)&&param.is_hot!=\"-1\"){\n      sql=sql.where({'f.is_hot':['like', '%'+param.is_hot+'%']});\n    }\n    let data = await sql.countSelect();\n    return data;\n  }\n\n  async allData(param){\n    let data=await this.where({del_flag:0}).select();\n    return data;\n  }\n\n  async getData(id){\n    return await this.where({id: id,del_flag:0}).find();\n  }\n\n\n  async changeStatus(param){\n    let id=param.id;\n    param.update_date=think.datetime();\n    let type=param.type;\n    if(type==1){\n        await this.where({id:id}).update({is_on_sale:param.data,update_date:param.update_date});\n    }else if(type==2){\n        await this.where({id:id}).update({is_new:param.data,update_date:param.update_date});\n    }else if(type==3){\n        await this.where({id:id}).update({is_hot:param.data,update_date:param.update_date});\n    }    \n  }\n\n};\n"
    ]
}